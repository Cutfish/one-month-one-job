1. 独立开发一款基于 gin+ go-micro+MySQL+redis+ceph的分布式云存储系统
- ceph是一个分布式存储系统。部署简单、支持多语言、可靠性高、性能高、分布式扩展性强、开源，主要用的是RGW的接口，只能在linux上面用。对象存储：文件会拆分成多个 RADOS 对象（如果文件较大，会进行分块存储）。元数据：Ceph 使用 omap 记录 S3 对象的元数据（例如文件名、大小、etag 等）。数据分布：所有数据存储在 RADOS 池（pool）中，数据会根据 CRUSH 规则自动分布到 OSD 上。
- RADOSGW、MON、OSD有这三种节点
RADOSGW 接收 S3 上传请求，将 example.txt 切成多个对象。
MON 维护 Ceph 集群的状态，并告诉客户端数据要存在哪些 OSD 里。
OSD 负责存储 example.txt 的多个副本，确保数据安全。
- ceph腾讯云自带的都有分块上传api，ceph也可以实现并行上传，腾讯云好像只有串行。并行上传可以用waitgroup

2. 采用 consu进行服务发现，实现了私有云和公有云两种不同存储方式
- 私有云是ceph,可以部署在本地，公有云是阿里云和腾讯云（腾讯云分块上传有接口，但是分块是限制在1MB）
3. 上传文件的异步处理使用了消息队列RabbitMQ，邮箱验证码和文件分块信息采用redis进行保存
4. MySQL采用主从复制模式，读写分离，数据的写操作不会影响读操作
5. 系统功能类似网盘，可根据用户名及密码管理个人的云存储文件并分享，并且同时实现了文件秒传、分块上传以及断点续传和断点下载等功能
- 文件秒传：先获取文件的hash，与数据库中对比，如果有直接在数据库中逻辑复制
- 分块上传、断点续传、断点下载：
本地分块-->初始化信息存储到redis-->每一块串行依次传入到存储系统-->将块信息也传入到redis-->前端显示一个百分比进度条
暂停上传：分块上传-->定期检查文件上传信息-->是否是被暂停/被取消/全部上传完成
取消上传：根据redis中已经存在的块信息-->删除云储存系统里面的块和redis对应块信息-->删除redis初始化信息
恢复上传：并行的-->初始化分块信息时候可以把所有块信息也都写到redis中-->检查哪些块未上传接着上传
         串行的-->找到第一个未上传的-->传这个和之后的（串行时候前一个返回传输成功才添加redis信息）
6. 针对部分项目模块，先进行单元测试，并利用 Postman或者curl对各个接口进行验收验证。
7. 项目部署使用了 docker及 kubernetes 等容器化技术

### 利用 RabbitMQ 进行异步任务处理，加速文件上传流程
1. rabbitmq控制台：创建交换机（direct：相同的key才传递）和消息队列
2. config/rabbitmq.go:配置端口、是否开启异步模式、路由key、交换机名称、队列名称
3. 创建mq文件夹（define.go、producer.go、consumer.go）
    define.go：TransferData : 将要写到rabbitmq的数据的结构体（当前文件路径和目标文件路径）
    producer.go：初始化connection和channel，发布消息函数
    consumer.go：接收消息函数：循环读取channel中的数据
4. handler/upload.go：如果开启异步模式：发送消息
5. service/transfer/main.go && service/upload/main.go 
    transfer/main.go:设置回调函数（将文件存储到OSS中），开启消费函数（如果有消息在队列中就调用回调函数）

### go-micro
**流程**
1、定义接口
>基于proto协议
>使用protoc-gen-micro生成micro代码

2、实现接口
> 定义Handler

3、创建服务
> NewService服务
> Init初始化
> 挂载接口
> 运行

**RPC层次**
1.  Service
2.  Client：发送RPC请求与广播信息
    Server：接受RPC请求与广播信息
3.  Broke：异步通信组件（rabbitmq）
    Codec：数据编码组件（protobuf）
    Registry：服务注册组件（consul、k8s）
    Selector：客户端均衡器：当多个实例提供相同服务时，决定负载均衡策略。（Traefik）
    transport：同步通信组件（rpc）

**Docker**
1. 通过Dockerfile定义容器环境，打包成镜像
2. 通过docker-compose.yml定义各应用服务
3. 用docker-compose up启动所有的容器

**反向代理负载均衡traefik**
- 相比于nginx，它能够自动发现后端服务，无需手动配置代理规则。
- Frontend（Routers路由）：处理用户请求，定义路由规则（如域名、路径等）。负责接收和处理外部请求，然后决定将请求转发到哪个Backend。
- Backend（Services服务）：真正的服务，Frontend会把请求转发到Backend。是一个真正的应用（Web服务、Pod、Docker容器）

**k8s**
用了这个之后服务注册中心就从consul变成了k8s


**HTTP和RPC**
| **特点**      | **HTTP**                      | **RPC**                                       |
|--------------|------------------------------|----------------------------------------------|
| **适合场景**  | Web 应用、前后端交互、开放 API  | 微服务、分布式系统、高性能需求                |
| **数据格式**  | JSON/XML（文本格式）          | Protobuf、Thrift（二进制格式）                |
| **调用方式**  | 通过 URL 访问资源            | 直接调用远程方法                              |
| **传输效率**  | 低，HTTP 头部较大            | 高，二进制序列化减少开销                      |
| **可读性**    | 易读，调试方便                | 需要工具解析                                  |

- **前后端交互（Web API）** → 选 **HTTP（RESTful API）**
- **微服务内部通信** → 选 **RPC（gRPC、Thrift）**


# 技术栈面试问题及回答示例

下面整理了在该项目中各个技术栈的详细问题和回答示例，帮助您更全面地展示对项目技术体系的理解和掌握情况。

---

## 1. Gin

### 问题 1：为什么选择 Gin 作为 Web 框架？
**回答示例：**  
“我选择 Gin 主要是因为它的高性能和轻量级特点。Gin 内置了高效的路由匹配和中间件支持，能够满足我们对 API 网关和微服务的高并发需求。此外，Gin 的错误处理和日志记录功能也让调试和维护变得更简单。”

### 问题 2：在 Gin 中如何处理静态文件？
**回答示例：**  
“在项目中，我们通过 `gin-contrib/static` 处理静态文件，但为了更好地管理部署，使用了 `go-bindata` 将静态文件嵌入到二进制中。这样可以避免依赖外部文件系统，确保部署时环境的一致性，并简化运维管理。”

---

## 2. Go-Micro

### 问题 1：为什么选择 Go-Micro 构建微服务？
**回答示例：**  
“Go-Micro 提供了一个完备的微服务生态系统，包括服务注册、负载均衡、RPC 调用、异步消息等内置支持，能够大大简化微服务的开发和维护。它与 Consul、Traefik 等组件的集成也十分紧密，使得整个服务网格更加稳定和高效。”

### 问题 2：Go-Micro 如何实现高效的 RPC 通信？
**回答示例：**  
“Go-Micro 封装了底层 RPC 调用细节，利用 ProtoBuf 进行数据编码，实现二进制传输，从而显著减少数据包大小和网络开销。同时，通过 transport 模块可以灵活切换不同的传输协议，如 gRPC，这为系统的高并发调用提供了保障。”

---

## 3. MySQL

### 问题 1：在项目中如何保证 MySQL 在高并发下的数据一致性和性能？
**回答示例：**  
“我们采用了主从复制与读写分离的架构。主库处理写操作，从库负责查询，既保证了数据的一致性，又有效分担了查询压力。此外，必要时可以使用分库分表来进一步优化性能。”

### 问题 2：遇到数据库瓶颈时，您如何应对？
**回答示例：**  
“除了读写分离外，我们还结合 Redis 缓存热点数据，减少对数据库的直接访问。同时，通过慢查询日志监控数据库性能，定期进行索引优化和 SQL 调优，以保持数据库高效运行。”

---

## 4. Redis

### 问题 1：Redis 在项目中的主要用途有哪些？
**回答示例：**  
“在项目中，Redis 主要用于存储文件分块信息，以支持断点续传，同时存储邮箱验证码和用户会话信息，以提升注册登录的响应速度。通过 Redis 高速的内存存储，我们能够在高并发环境下迅速返回结果，改善用户体验。”

### 问题 2：如何保证 Redis 数据的稳定性和可靠性？
**回答示例：**  
“我们采用了 Redis 持久化机制（RDB/AOF）来防止数据丢失，并设置了主从复制以实现高可用性。同时，通过监控 Redis 的内存和性能指标，及时调整配置参数，确保系统在高负载下依然稳定运行。”

---

## 5. Ceph

### 问题 1：为什么选择 Ceph 作为私有云存储解决方案？
**回答示例：**  
“Ceph 提供分布式存储、自动故障转移以及横向扩展能力，非常适合处理海量数据存储的需求。它能实现高可用性和数据冗余，与公有云存储（如阿里 OSS、腾讯 COS）相结合，实现灵活的存储策略，根据不同业务场景动态切换存储后端。”

### 问题 2：如何实现私有云与公有云存储的动态切换？
**回答示例：**  
“在设计时，我们抽象出统一的存储接口，通过配置中心控制选择存储后端。当系统检测到私有云资源不足或需要扩展时，可以动态切换到公有云存储，从而保证数据存储的连续性和高可用性。”

---

## 6. Consul

### 问题 1：Consul 在服务注册与发现中的作用是什么？
**回答示例：**  
“Consul 作为注册中心，自动注册所有微服务实例，并定期进行健康检查。这样，当客户端调用服务时，能够通过 Consul 动态获取最新的实例列表，从而实现高效的服务发现和故障切换。”

### 问题 2：如何与 Go-Micro 集成使用 Consul？
**回答示例：**  
“我们在 Go-Micro 的配置中指定 Consul 作为服务注册中心，这样每个服务在启动时都会自动注册到 Consul，同时客户端在调用时通过 Consul 获取服务列表，实现无缝对接和负载均衡。”

---

## 7. Traefik

### 问题 1：Traefik 如何实现负载均衡和动态路由？
**回答示例：**  
“Traefik 通过监控 Consul 或 Kubernetes 中的服务变更，自动配置路由规则，并基于内置的负载均衡算法（如轮询、最少连接）将请求分发到多个实例。这样可以有效分散流量，提高系统稳定性。”

### 问题 2：与传统负载均衡器相比，Traefik 有什么优势？
**回答示例：**  
“Traefik 支持自动发现和动态配置，无需手动修改配置文件。它还内置了对 HTTPS 证书的管理功能，可以自动申请和续期 SSL 证书，降低运维复杂度，同时支持多种协议和中间件，适应微服务环境的多变需求。”

---

## 8. RabbitMQ

### 问题 1：RabbitMQ 在项目中如何加速文件上传流程？
**回答示例：**  
“文件上传过程中，部分耗时操作（如分块上传校验和数据处理）通过 RabbitMQ 异步处理，减小主流程响应时间。消息队列将上传任务拆分为多个子任务并行处理，从而提升整体上传效率和系统吞吐量。”

### 问题 2：如何确保 RabbitMQ 的消息可靠性？
**回答示例：**  
“我们配置了消息确认机制和持久化策略，确保消息在传输过程中不会丢失。同时，通过合理设计队列长度和监控指标，及时处理队列积压和异常情况，保证系统稳定运行。”

---

## 9. ProtoBuf

### 问题 1：为什么选择 ProtoBuf 进行数据编码？
**回答示例：**  
“ProtoBuf 是一种高效的二进制序列化协议，与 JSON 相比，它具有更小的数据包体积和更快的解析速度，特别适用于高并发的 RPC 通信。其强类型机制还可以在编译期发现数据不一致问题，降低运行时错误的风险。”

### 问题 2：在 Go-Micro 中如何使用 ProtoBuf？
**回答示例：**  
“在 Go-Micro 中，我们定义了 .proto 文件，通过 protoc 工具生成对应的 Go 代码，然后在服务间的 RPC 调用中使用这些生成的类型进行数据传输，实现高效、可靠的通信。”

---

## 10. JWT 双 Token 刷新策略

### 问题 1：双 Token 刷新策略如何提升系统安全性？
**回答示例：**  
“双 Token 策略中，我们采用短时 Token 用于频繁访问，长时 Token 用于刷新短时 Token。这样既降低了单个 Token 被泄露后的风险，又减少了频繁认证对系统性能的影响，确保 API 请求的安全性。”

### 问题 2：如何处理 Token 的刷新和失效？
**回答示例：**  
“系统在每次验证时会检查 Token 的有效期，若短时 Token即将过期，则允许使用长时 Token刷新新的短时 Token。刷新成功后，旧的 Token 立即失效，从而避免并发认证带来的安全风险。”

---

## 11. Docker & Kubernetes

### 问题 1：为什么选择 Docker 和 Kubernetes 部署项目？
**回答示例：**  
“Docker 能够将各个微服务封装成独立的容器，确保环境一致性和快速部署；Kubernetes 提供自动扩缩容、服务发现和故障自愈等能力，使得整个微服务系统更易于管理和维护，提升了系统的可移植性和部署效率。”

### 问题 2：在 Kubernetes 中如何管理服务的扩展性？
**回答示例：**  
“Kubernetes 通过 Deployment 对象管理服务副本，结合 Horizontal Pod Autoscaler 实现自动扩容。当监控指标（如 CPU 或内存使用率）达到预设阈值时，Kubernetes 会自动增加或减少 Pod 数量，从而保证系统始终处于最佳运行状态。”

---

以上问题和回答示例覆盖了项目中使用的主要技术栈和核心实现细节，能够帮助您在面试中充分展示自己对系统架构和关键技术的深入理解。
