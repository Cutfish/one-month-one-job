1. 独立开发一款基于 gin+ go-micro+MySQL+redis+ceph的分布式云存储系统
- ceph是一个分布式存储系统。部署简单、支持多语言、可靠性高、性能高、分布式扩展性强、开源，主要用的是RGW的接口，只能在linux上面用。对象存储：文件会拆分成多个 RADOS 对象（如果文件较大，会进行分块存储）。元数据：Ceph 使用 omap 记录 S3 对象的元数据（例如文件名、大小、etag 等）。数据分布：所有数据存储在 RADOS 池（pool）中，数据会根据 CRUSH 规则自动分布到 OSD 上。
- RADOSGW、MON、OSD有这三种节点
RADOSGW 接收 S3 上传请求，将 example.txt 切成多个对象。
MON 维护 Ceph 集群的状态，并告诉客户端数据要存在哪些 OSD 里。
OSD 负责存储 example.txt 的多个副本，确保数据安全。
- ceph腾讯云自带的都有分块上传api，ceph也可以实现并行上传，腾讯云好像只有串行。并行上传可以用waitgroup

2. 采用 consu进行服务发现，实现了私有云和公有云两种不同存储方式
- 私有云是ceph,可以部署在本地，公有云是阿里云和腾讯云（腾讯云分块上传有接口，但是分块是限制在1MB）
3. 上传文件的异步处理使用了消息队列RabbitMQ，邮箱验证码和文件分块信息采用redis进行保存
4. MySQL采用主从复制模式，读写分离，数据的写操作不会影响读操作
5. 系统功能类似网盘，可根据用户名及密码管理个人的云存储文件并分享，并且同时实现了文件秒传、分块上传以及断点续传和断点下载等功能
- 文件秒传：先获取文件的hash，与数据库中对比，如果有直接在数据库中逻辑复制
- 分块上传、断点续传、断点下载：
本地分块-->初始化信息存储到redis-->每一块串行依次传入到存储系统-->将块信息也传入到redis-->前端显示一个百分比进度条
暂停上传：分块上传-->定期检查文件上传信息-->是否是被暂停/被取消/全部上传完成
取消上传：根据redis中已经存在的块信息-->删除云储存系统里面的块和redis对应块信息-->删除redis初始化信息
恢复上传：并行的-->初始化分块信息时候可以把所有块信息也都写到redis中-->检查哪些块未上传接着上传
         串行的-->找到第一个未上传的-->传这个和之后的（串行时候前一个返回传输成功才添加redis信息）
6. 针对部分项目模块，先进行单元测试，并利用 Postman或者curl对各个接口进行验收验证。
7. 项目部署使用了 docker及 kubernetes 等容器化技术，并可基于 gitlab+Jenkins+Harbor 自动化部署

### 利用 RabbitMQ 进行异步任务处理，加速文件上传流程
1. rabbitmq控制台：创建交换机（direct：相同的key才传递）和消息队列
2. config/rabbitmq.go:配置端口、是否开启异步模式、路由key、交换机名称、队列名称
3. 创建mq文件夹（define.go、producer.go、consumer.go）
    define.go：TransferData : 将要写到rabbitmq的数据的结构体（当前文件路径和目标文件路径）
    producer.go：初始化connection和channel，发布消息函数
    consumer.go：接收消息函数：循环读取channel中的数据
4. handler/upload.go：如果开启异步模式：发送消息
5. service/transfer/main.go && service/upload/main.go 
    transfer/main.go:设置回调函数（将文件存储到OSS中），开启消费函数（如果有消息在队列中就调用回调函数）

### go-micro
**流程**
1、定义接口
>基于proto协议
>使用protoc-gen-micro生成micro代码

2、实现接口
> 定义Handler

3、创建服务
> NewService服务
> Init初始化
> 挂载接口
> 运行

**RPC层次**
1.  Service
2.  Client：发送RPC请求与广播信息
    Server：接受RPC请求与广播信息
3.  Broke：异步通信组件
    Codec：数据编码组件
    Registry：服务注册组件
    Selector：客户端均衡器
    transport：同步通信组件
